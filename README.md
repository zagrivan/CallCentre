# Call Centre
## Эмуляция работы ЦОВ на HTTP сервере

### Требования

* C++20
* g++
* cmake 3.26
* Boost 1.81 или новее
  * Asio и Beast
  * Если нет boost, то cmake сам установит его через fetch content

После того как проект построен и скомпилирован, нужно будет около исполняемого файла положить файл с конфигурацией.
Пример конфига представлен в `config_call_centre.json`
```json
{
  "count_operators": 10,
  "incoming_queue_size": 10,
  "rand_call_duration": {
    "rand_gen_erl_shape": 100,
    "rand_gen_erl_scale": 1
  },
  "rand_timeout_in_queue": {
    "rand_uniform_min": 20,
    "rand_uniform_max": 50
  },
  "log": {
    "server_level": "error",
    "operators_level": "info"
  }
}
```
### Поля json
* `count_operators` - количество операторов, которые будут принимать звонки
* `incoming_queue_size` - максимальный размер очереди входящих вызовов
* `rand_call_duration` - Используется в `RandGen.cpp` для генерации продолжительности разговора. Два значения для `std::gamma_distribution<>(shape, scale)`, которое при целых параметрах является распределением Эрланга.
Я выбрал именно это распределение, т.к. оно приближено к плотности распределения продолжительности разговора в реальных системах.
  * `rand_gen_erl_shape` - переменная формы, 
  * `rand_gen_erl_scale` - переменная масштаба

При манипуляциях с двумя этими переменными можно получить разные плотности распределения, но одно значение средней продолжительности вызова. 
Например, shape=10 scale=1 и shape=1 scale=10 дадут среднюю средней продолжительность вызова равную 10 сек, 
но в первом случае будет больше вызовов с временем около 10 сек, во втором случае будет больше коротких вызовов.

* `rand_timeout_in_queue` - Используется в `RandGen.cpp` для генерации времени ожидания в очереди, после которого вызов сбрасывается. 
Используется равномерное распределение `std::uniform_real_distribution<double>(min, max)`.
  * rand_uniform_min и rand_uniform_max - в секундах.
* `log` - два значения для вывода логов с http сервера и с операторов. (debug, info, warn, error, critical, off) - доступные значения.

## Описание

В качестве http сервера взял за основу асинхронный сервер с документации boost beast.
Класс listener слушает подключения и передает открытый сокет в класс Session, который является http сессией. 
В Session производится валидация http запроса и введенного номера телефона, создается объект Call. Call - это структура, 
которая хранит все значения, связанные с вызовом.
После успешной проверки Call кладется в очередь, которая реализована как класс IncomingCallsQueue.
Оттуда звонок либо удаляется, если долго ждет, либо его забирает свободный оператор.
Логика операторов представлена в классе Operators.
Логер и генерация случайных чисел представлены как static классы Log и RandGen, их инициализация происходит в `main.cpp` значениями из конфиг файла.
Чтение конфига выполняет класс ReadConfig.

### Запуск исполняемого файла
  `$ ./CallCentre <address> <port> <threads> <config file = config_call_centre.json>` Последний парметр не обязателен, если не меняли имя конфига и он лежит около исп. файла.
```
  $ ./CallCentre 0.0.0.0 8080 3 config_call_centre.json
```

### Примеры запросов к серверу
`localhost:8080/88129885723` `localhost:8080/+78129885723` `localhost:8080/8129885723`
